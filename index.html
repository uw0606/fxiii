<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ドル円ローソク足チャート</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-financial"></script>
  <style>
    body {
      background-color: #1c1c1c;
      color: #fff;
      font-family: sans-serif;
      text-align: center;
      padding: 30px;
    }
    canvas {
      max-width: 800px;
      margin: auto;
      background-color: #fff;
      border-radius: 10px;
    }
  </style>
</head>
<body>

  <h1>ドル円ローソク足チャート</h1>
  <canvas id="candlestickChart" width="800" height="400"></canvas>

  <script>
  const ctx = document.getElementById('candlestickChart').getContext('2d');
  const candlestickChart = new Chart(ctx, {
    type: 'candlestick',
    data: {
      datasets: [{
        label: 'USD/JPY',
        data: []
      }]
    },
    options: {
      responsive: true,
      scales: {
        x: {
          type: 'time',
          time: {
            unit: 'minute'
          },
          ticks: {
            color: '#fff'
          }
        },
        y: {
          ticks: {
            color: '#fff'
          }
        }
      },
      plugins: {
        legend: {
          labels: {
            color: '#fff'
          }
        }
      }
    }
  });

  // 初期データ
  for (let i = 0; i < 20; i++) {
    candlestickChart.data.datasets[0].data.push(generateMockData());
  }
  candlestickChart.update();

  // モックデータ関数（最初のチャート用）
  function generateMockData() {
    const now = new Date();
    const open = 157 + Math.random();
    const close = open + (Math.random() - 0.5);
    const high = Math.max(open, close) + Math.random() * 0.5;
    const low = Math.min(open, close) - Math.random() * 0.5;

    return {
      x: now,
      o: open,
      h: high,
      l: low,
      c: close
    };
  }

  // 実データを10秒ごとに取得
  setInterval(() => {
    fetch('https://api.unirateapi.com/api/rates?api_key=h65qd0ij5fNu2TlJkWtzaiDSss70pXNVDHLYUTfrFjD2az8limCXMVBbaEf5BBZT&from=USD')
      .then(response => response.json())
      .then(data => {
        const rate = data.rates.JPY;
        const now = new Date();
        const fluctuation = (Math.random() - 0.5) * 0.2;

        const newPoint = {
          x: now,
          o: rate - 0.1,
          h: rate + fluctuation,
          l: rate - fluctuation,
          c: rate
        };

        candlestickChart.data.datasets[0].data.push(newPoint);
        if (candlestickChart.data.datasets[0].data.length > 20) {
          candlestickChart.data.datasets[0].data.shift();
        }
        candlestickChart.update();
      })
      .catch(err => console.error("為替データ取得失敗:", err));
  }, 10000);
</script>


</body>
</html>
